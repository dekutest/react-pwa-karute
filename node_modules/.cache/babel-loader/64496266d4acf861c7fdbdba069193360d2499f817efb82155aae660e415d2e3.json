{"ast":null,"code":"var _jsxFileName = \"/Users/y/Documents/GitHub/react-pwa-karute/src/components/Login.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { supabase } from '../supabaseClient';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Login = () => {\n  _s();\n  const [userRole, setUserRole] = useState(null);\n  const handleGoogleLogin = async () => {\n    const {\n      error\n    } = await supabase.auth.signInWithOAuth({\n      provider: 'google'\n    });\n    if (error) console.error('ログインエラー:', error.message);\n  };\n\n  // ユーザー情報を登録する関数\n  const registerUser = async user => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('users').upsert([{\n        id: user.id,\n        email: user.email,\n        name: user.user_metadata.full_name || 'No Name',\n        role: 'practitioner'\n      }]);\n      if (error) {\n        console.error('ユーザー登録エラー:', error.message);\n      } else {\n        console.log('ユーザー登録成功:', data);\n      }\n    } catch (err) {\n      console.error('アップサート処理エラー:', err.message);\n    }\n  };\n\n  // ログインユーザーの権限を取得\n  const fetchUserRole = async userId => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('users').select('role').eq('id', userId).single();\n      if (error) {\n        console.error('権限取得エラー:', error.message);\n      } else {\n        setUserRole(data.role);\n        console.log('ユーザー権限:', data.role);\n      }\n    } catch (err) {\n      console.error('権限取得失敗:', err.message);\n    }\n  };\n  useEffect(() => {\n    const getUserInfo = async () => {\n      const {\n        data: {\n          session\n        }\n      } = await supabase.auth.getSession();\n      if (session) {\n        console.log('ログイン成功:', session.user);\n        await registerUser(session.user);\n        await fetchUserRole(session.user.id); // 権限を取得\n      }\n    };\n    getUserInfo();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Google\\u30ED\\u30B0\\u30A4\\u30F3\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleGoogleLogin,\n      children: \"Google\\u3067\\u30ED\\u30B0\\u30A4\\u30F3\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), userRole && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"\\u3042\\u306A\\u305F\\u306E\\u6A29\\u9650: \", userRole]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 20\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this);\n};\n_s(Login, \"vPp0yqj+hRw1UlF3QGOL0H6Z92E=\");\n_c = Login;\nexport default Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["React","useEffect","useState","supabase","jsxDEV","_jsxDEV","Login","_s","userRole","setUserRole","handleGoogleLogin","error","auth","signInWithOAuth","provider","console","message","registerUser","user","data","from","upsert","id","email","name","user_metadata","full_name","role","log","err","fetchUserRole","userId","select","eq","single","getUserInfo","session","getSession","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["/Users/y/Documents/GitHub/react-pwa-karute/src/components/Login.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { supabase } from '../supabaseClient';\n\nconst Login = () => {\n  const [userRole, setUserRole] = useState(null);\n\n  const handleGoogleLogin = async () => {\n    const { error } = await supabase.auth.signInWithOAuth({\n      provider: 'google',\n    });\n    if (error) console.error('ログインエラー:', error.message);\n  };\n\n  // ユーザー情報を登録する関数\n  const registerUser = async (user) => {\n    try {\n      const { data, error } = await supabase\n        .from('users')\n        .upsert([{ \n          id: user.id,  \n          email: user.email, \n          name: user.user_metadata.full_name || 'No Name', \n          role: 'practitioner'  \n        }]);\n\n      if (error) {\n        console.error('ユーザー登録エラー:', error.message);\n      } else {\n        console.log('ユーザー登録成功:', data);\n      }\n    } catch (err) {\n      console.error('アップサート処理エラー:', err.message);\n    }\n  };\n\n  // ログインユーザーの権限を取得\n  const fetchUserRole = async (userId) => {\n    try {\n      const { data, error } = await supabase\n        .from('users')\n        .select('role')\n        .eq('id', userId)\n        .single();\n\n      if (error) {\n        console.error('権限取得エラー:', error.message);\n      } else {\n        setUserRole(data.role);\n        console.log('ユーザー権限:', data.role);\n      }\n    } catch (err) {\n      console.error('権限取得失敗:', err.message);\n    }\n  };\n\n  useEffect(() => {\n    const getUserInfo = async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (session) {\n        console.log('ログイン成功:', session.user);\n        await registerUser(session.user);\n        await fetchUserRole(session.user.id);  // 権限を取得\n      }\n    };\n    getUserInfo();\n  }, []);\n\n  return (\n    <div>\n      <h2>Googleログイン</h2>\n      <button onClick={handleGoogleLogin}>Googleでログイン</button>\n      {userRole && <p>あなたの権限: {userRole}</p>}\n    </div>\n  );\n};\n\nexport default Login;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,QAAQ,QAAQ,mBAAmB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE7C,MAAMC,KAAK,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAClB,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGP,QAAQ,CAAC,IAAI,CAAC;EAE9C,MAAMQ,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IACpC,MAAM;MAAEC;IAAM,CAAC,GAAG,MAAMR,QAAQ,CAACS,IAAI,CAACC,eAAe,CAAC;MACpDC,QAAQ,EAAE;IACZ,CAAC,CAAC;IACF,IAAIH,KAAK,EAAEI,OAAO,CAACJ,KAAK,CAAC,UAAU,EAAEA,KAAK,CAACK,OAAO,CAAC;EACrD,CAAC;;EAED;EACA,MAAMC,YAAY,GAAG,MAAOC,IAAI,IAAK;IACnC,IAAI;MACF,MAAM;QAAEC,IAAI;QAAER;MAAM,CAAC,GAAG,MAAMR,QAAQ,CACnCiB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,CAAC;QACPC,EAAE,EAAEJ,IAAI,CAACI,EAAE;QACXC,KAAK,EAAEL,IAAI,CAACK,KAAK;QACjBC,IAAI,EAAEN,IAAI,CAACO,aAAa,CAACC,SAAS,IAAI,SAAS;QAC/CC,IAAI,EAAE;MACR,CAAC,CAAC,CAAC;MAEL,IAAIhB,KAAK,EAAE;QACTI,OAAO,CAACJ,KAAK,CAAC,YAAY,EAAEA,KAAK,CAACK,OAAO,CAAC;MAC5C,CAAC,MAAM;QACLD,OAAO,CAACa,GAAG,CAAC,WAAW,EAAET,IAAI,CAAC;MAChC;IACF,CAAC,CAAC,OAAOU,GAAG,EAAE;MACZd,OAAO,CAACJ,KAAK,CAAC,cAAc,EAAEkB,GAAG,CAACb,OAAO,CAAC;IAC5C;EACF,CAAC;;EAED;EACA,MAAMc,aAAa,GAAG,MAAOC,MAAM,IAAK;IACtC,IAAI;MACF,MAAM;QAAEZ,IAAI;QAAER;MAAM,CAAC,GAAG,MAAMR,QAAQ,CACnCiB,IAAI,CAAC,OAAO,CAAC,CACbY,MAAM,CAAC,MAAM,CAAC,CACdC,EAAE,CAAC,IAAI,EAAEF,MAAM,CAAC,CAChBG,MAAM,CAAC,CAAC;MAEX,IAAIvB,KAAK,EAAE;QACTI,OAAO,CAACJ,KAAK,CAAC,UAAU,EAAEA,KAAK,CAACK,OAAO,CAAC;MAC1C,CAAC,MAAM;QACLP,WAAW,CAACU,IAAI,CAACQ,IAAI,CAAC;QACtBZ,OAAO,CAACa,GAAG,CAAC,SAAS,EAAET,IAAI,CAACQ,IAAI,CAAC;MACnC;IACF,CAAC,CAAC,OAAOE,GAAG,EAAE;MACZd,OAAO,CAACJ,KAAK,CAAC,SAAS,EAAEkB,GAAG,CAACb,OAAO,CAAC;IACvC;EACF,CAAC;EAEDf,SAAS,CAAC,MAAM;IACd,MAAMkC,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,MAAM;QAAEhB,IAAI,EAAE;UAAEiB;QAAQ;MAAE,CAAC,GAAG,MAAMjC,QAAQ,CAACS,IAAI,CAACyB,UAAU,CAAC,CAAC;MAC9D,IAAID,OAAO,EAAE;QACXrB,OAAO,CAACa,GAAG,CAAC,SAAS,EAAEQ,OAAO,CAAClB,IAAI,CAAC;QACpC,MAAMD,YAAY,CAACmB,OAAO,CAAClB,IAAI,CAAC;QAChC,MAAMY,aAAa,CAACM,OAAO,CAAClB,IAAI,CAACI,EAAE,CAAC,CAAC,CAAE;MACzC;IACF,CAAC;IACDa,WAAW,CAAC,CAAC;EACf,CAAC,EAAE,EAAE,CAAC;EAEN,oBACE9B,OAAA;IAAAiC,QAAA,gBACEjC,OAAA;MAAAiC,QAAA,EAAI;IAAU;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eACnBrC,OAAA;MAAQsC,OAAO,EAAEjC,iBAAkB;MAAA4B,QAAA,EAAC;IAAW;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CAAC,EACvDlC,QAAQ,iBAAIH,OAAA;MAAAiC,QAAA,GAAG,wCAAQ,EAAC9B,QAAQ;IAAA;MAAA+B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACnC,CAAC;AAEV,CAAC;AAACnC,EAAA,CAvEID,KAAK;AAAAsC,EAAA,GAALtC,KAAK;AAyEX,eAAeA,KAAK;AAAC,IAAAsC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}